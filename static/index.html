<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Empower Pilates Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .chat {
      width: 100%;
      max-width: 420px;
      height: 90vh;
      background: #1c1c1c;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      padding: 12px;
      background: #0f766e;
      font-weight: bold;
      text-align: center;
    }

    .messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
    }

    .msg {
      margin-bottom: 10px;
      max-width: 80%;
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
    }

    .bot {
      background: #2a2a2a;
      align-self: flex-start;
    }

    .user {
      background: #0f766e;
      align-self: flex-end;
    }

    .input {
      display: flex;
      padding: 10px;
      background: #000;
    }

    .input input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    .input button {
      margin-left: 8px;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      background: #0f766e;
      color: #fff;
      cursor: pointer;
    }

    .quick {
      display: flex;
      gap: 6px;
      padding: 8px;
      flex-wrap: wrap;
      background: #111;
    }

    .quick button {
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #333;
      color: #fff;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>
<body>

<div class="chat">
  <div class="header">Empower Pilates</div>

  <div class="messages" id="messages"></div>

  <div class="quick">
    <button onclick="sendQuick('Book a class')">Book a class</button>
    <button onclick="sendQuick('Free trial')">Free trial</button>
    <button onclick="sendQuick('What are your hours?')">What are your hours?</button>
    <button onclick="sendQuick('Where are you located?')">Where are you located?</button>
  </div>

  <div class="input">
    <input id="input" placeholder="Type a message..." />
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
  const API_BASE = window.location.origin;

  // ğŸ” ×”×—×œ×£ ×œ×¢×¨×š ×©×œ APP_TOKEN ×-Render
  const APP_TOKEN = "pilates_chat_9o8i7u6y5t!!";

  const messagesEl = document.getElementById("messages");
  const inputEl = document.getElementById("input");

  function addMessage(text, who) {
    const div = document.createElement("div");
    div.className = "msg " + who;
    div.innerText = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function sendMessage(message) {
    const res = await fetch(`${API_BASE}/api/chat`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-app-token": APP_TOKEN
      },
      body: JSON.stringify({
        session_id: "web",
        message
      })
    });

    if (!res.ok) {
      throw new Error("API error " + res.status);
    }

    return await res.json();
  }

  async function send() {
    const text = inputEl.value.trim();
    if (!text) return;

    inputEl.value = "";
    addMessage(text, "user");

    try {
      const data = await sendMessage(text);
      addMessage(data.reply, "bot");
    } catch (e) {
      addMessage("Connection error. Please try again.", "bot");
    }
  }

  function sendQuick(text) {
    inputEl.value = text;
    send();
  }

  // ×”×•×“×¢×ª ×¤×ª×™×—×”
  addMessage(
    "Hi ğŸ‘‹\nHow can I help you today?\n\nâ€¢ Book a Pilates class\nâ€¢ Start a free trial\nâ€¢ Check our hours or location",
    "bot"
  );
</script>

</body>
</html>
